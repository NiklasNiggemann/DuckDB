
------------------------------------------------


*** Run 1/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                   ┆ views   ┆ carts  ┆ purchases │
│ ---                             ┆ ---     ┆ ---    ┆ ---       │
│ str                             ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════════╪═════════╪════════╪═══════════╡
│ appliances.kitchen.steam_cooke… ┆ 18856   ┆ 578    ┆ 207       │
│ appliances.kitchen.mixer        ┆ 140422  ┆ 5719   ┆ 1724      │
│ computers.notebook              ┆ 2103024 ┆ 59097  ┆ 18433     │
│ medicine.tools.tonometer        ┆ 20764   ┆ 1274   ┆ 344       │
│ electronics.audio.headphone     ┆ 1644910 ┆ 131133 ┆ 40834     │
│ …                               ┆ …       ┆ …      ┆ …         │
│ electronics.camera.photo        ┆ 18963   ┆ 710    ┆ 211       │
│ construction.tools.screw        ┆ 182     ┆ 1      ┆ 1         │
│ auto.accessories.winch          ┆ 5876    ┆ 56     ┆ 20        │
│ construction.tools.saw          ┆ 185580  ┆ 7488   ┆ 1810      │
│ sport.snowboard                 ┆ 17375   ┆ 423    ┆ 138       │
└─────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23    142.2 MiB    142.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  20983.0 MiB  20840.8 MiB           1       df = pl.read_csv(dataset_path)
    26   7356.6 MiB -13594.4 MiB           1       result = (
    27  20951.0 MiB    -32.0 MiB           1           df.group_by("category_code")
    28  20951.0 MiB  -5037.1 MiB           2           .agg([
    29  12393.6 MiB  -8557.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12393.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12393.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7356.8 MiB      0.3 MiB           1       print(result)


Memory = 7222.69 MB, Time = 6.68 s
Memory Profiler for Run 1/10

------------------------------------------------


*** Run 2/10 ***

shape: (130, 4)
┌─────────────────────────────┬─────────┬────────┬───────────┐
│ category_code               ┆ views   ┆ carts  ┆ purchases │
│ ---                         ┆ ---     ┆ ---    ┆ ---       │
│ str                         ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════╪═════════╪════════╪═══════════╡
│ appliances.iron             ┆ 278574  ┆ 14308  ┆ 4650      │
│ electronics.camera.photo    ┆ 18963   ┆ 710    ┆ 211       │
│ appliances.kitchen.fryer    ┆ 99      ┆ 8      ┆ 1         │
│ electronics.camera.video    ┆ 63819   ┆ 1616   ┆ 393       │
│ auto.accessories.winch      ┆ 5876    ┆ 56     ┆ 20        │
│ …                           ┆ …       ┆ …      ┆ …         │
│ country_yard.lawn_mower     ┆ 6173    ┆ 180    ┆ 38        │
│ electronics.audio.headphone ┆ 1644910 ┆ 131133 ┆ 40834     │
│ furniture.kitchen.chair     ┆ 180695  ┆ 6286   ┆ 1740      │
│ appliances.kitchen.hob      ┆ 179125  ┆ 5694   ┆ 1393      │
│ auto.accessories.alarm      ┆ 283328  ┆ 12029  ┆ 3258      │
└─────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7364.8 MiB   7364.8 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  14087.2 MiB   6722.4 MiB           1       df = pl.read_csv(dataset_path)
    26   7469.5 MiB  -6073.7 MiB           1       result = (
    27  13543.2 MiB   -544.0 MiB           1           df.group_by("category_code")
    28  13543.2 MiB  -4140.2 MiB           2           .agg([
    29  11609.7 MiB  -1933.5 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  11609.7 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  11609.7 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7469.9 MiB      0.4 MiB           1       print(result)


Memory = 116.27 MB, Time = 11.25 s
Memory Profiler for Run 2/10

------------------------------------------------


*** Run 3/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                   ┆ views   ┆ carts  ┆ purchases │
│ ---                             ┆ ---     ┆ ---    ┆ ---       │
│ str                             ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════════╪═════════╪════════╪═══════════╡
│ computers.notebook              ┆ 2103024 ┆ 59097  ┆ 18433     │
│ kids.skates                     ┆ 70649   ┆ 1489   ┆ 384       │
│ electronics.camera.photo        ┆ 18963   ┆ 710    ┆ 211       │
│ electronics.video.tv            ┆ 2071305 ┆ 106467 ┆ 30274     │
│ auto.accessories.compressor     ┆ 85659   ┆ 2682   ┆ 700       │
│ …                               ┆ …       ┆ …      ┆ …         │
│ computers.components.cooler     ┆ 70234   ┆ 2304   ┆ 640       │
│ appliances.kitchen.refrigerato… ┆ 1362018 ┆ 52102  ┆ 13042     │
│ appliances.environment.water_h… ┆ 194075  ┆ 11914  ┆ 3382      │
│ stationery.cartrige             ┆ 11943   ┆ 644    ┆ 191       │
│ appliances.personal.hair_cutte… ┆ 85361   ┆ 3592   ┆ 1162      │
└─────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7483.0 MiB   7483.0 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  15130.7 MiB   7647.6 MiB           1       df = pl.read_csv(dataset_path)
    26   7112.9 MiB  -7505.8 MiB           1       result = (
    27  14618.7 MiB   -512.0 MiB           1           df.group_by("category_code")
    28  14618.7 MiB  -5329.8 MiB           2           .agg([
    29  12570.7 MiB  -2048.0 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12506.7 MiB    -64.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12442.7 MiB    -64.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7113.5 MiB      0.6 MiB           1       print(result)


Memory = -354.97 MB, Time = 13.95 s
Memory Profiler for Run 3/10

------------------------------------------------


*** Run 4/10 ***

shape: (130, 4)
┌─────────────────────────────────┬──────────┬────────┬───────────┐
│ category_code                   ┆ views    ┆ carts  ┆ purchases │
│ ---                             ┆ ---      ┆ ---    ┆ ---       │
│ str                             ┆ u32      ┆ u32    ┆ u32       │
╞═════════════════════════════════╪══════════╪════════╪═══════════╡
│ auto.accessories.videoregister  ┆ 267878   ┆ 9168   ┆ 2313      │
│ apparel.skirt                   ┆ 8766     ┆ 61     ┆ 10        │
│ computers.components.cooler     ┆ 70234    ┆ 2304   ┆ 640       │
│ construction.tools.soldering    ┆ 3481     ┆ 39     ┆ 6         │
│ appliances.kitchen.meat_grinde… ┆ 242604   ┆ 10737  ┆ 3010      │
│ …                               ┆ …        ┆ …      ┆ …         │
│ electronics.audio.microphone    ┆ 44645    ┆ 1615   ┆ 489       │
│ null                            ┆ 20837460 ┆ 826493 ┆ 234218    │
│ accessories.wallet              ┆ 68909    ┆ 1119   ┆ 366       │
│ kids.skates                     ┆ 70649    ┆ 1489   ┆ 384       │
│ sport.snowboard                 ┆ 17375    ┆ 423    ┆ 138       │
└─────────────────────────────────┴──────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7128.2 MiB   7128.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  21811.5 MiB  14683.3 MiB           1       df = pl.read_csv(dataset_path)
    26   8590.7 MiB  -4790.8 MiB           1       result = (
    27  13381.5 MiB  -8429.9 MiB           1           df.group_by("category_code")
    28  13381.5 MiB  -4791.9 MiB           2           .agg([
    29  13382.6 MiB      1.0 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13382.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13382.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   8591.4 MiB      0.7 MiB           1       print(result)


Memory = 1476.25 MB, Time = 12.60 s
Memory Profiler for Run 4/10

------------------------------------------------


*** Run 5/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ construction.components.faucet  ┆ 45919   ┆ 1322  ┆ 388       │
│ computers.components.cooler     ┆ 70234   ┆ 2304  ┆ 640       │
│ furniture.bedroom.blanket       ┆ 28269   ┆ 657   ┆ 214       │
│ electronics.video.projector     ┆ 22423   ┆ 418   ┆ 99        │
│ computers.components.cpu        ┆ 81644   ┆ 2139  ┆ 510       │
│ …                               ┆ …       ┆ …     ┆ …         │
│ furniture.living_room.sofa      ┆ 417428  ┆ 6521  ┆ 1562      │
│ electronics.clocks              ┆ 1994440 ┆ 69289 ┆ 23237     │
│ furniture.bathroom.toilet       ┆ 28060   ┆ 964   ┆ 213       │
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ construction.tools.welding      ┆ 141960  ┆ 5431  ┆ 1119      │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   8602.7 MiB   8602.7 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  16726.5 MiB   8123.8 MiB           1       df = pl.read_csv(dataset_path)
    26   7817.5 MiB  -8397.0 MiB           1       result = (
    27  16214.5 MiB   -512.0 MiB           1           df.group_by("category_code")
    28  16214.5 MiB  -5791.9 MiB           2           .agg([
    29  13609.1 MiB  -2605.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13609.1 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13609.1 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7818.4 MiB      0.9 MiB           1       print(result)


Memory = -772.59 MB, Time = 12.23 s
Memory Profiler for Run 5/10

------------------------------------------------


*** Run 6/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ appliances.kitchen.washer       ┆ 1313807 ┆ 70287 ┆ 19772     │
│ apparel.jacket                  ┆ 1       ┆ 0     ┆ 0         │
│ sport.tennis                    ┆ 7539    ┆ 154   ┆ 48        │
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ furniture.kitchen.chair         ┆ 180695  ┆ 6286  ┆ 1740      │
│ …                               ┆ …       ┆ …     ┆ …         │
│ country_yard.cultivator         ┆ 9557    ┆ 162   ┆ 18        │
│ computers.notebook              ┆ 2103024 ┆ 59097 ┆ 18433     │
│ construction.tools.pump         ┆ 41675   ┆ 1568  ┆ 326       │
│ apparel.shoes.ballet_shoes      ┆ 4299    ┆ 58    ┆ 22        │
│ electronics.tablet              ┆ 464073  ┆ 22286 ┆ 6138      │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7830.1 MiB   7830.1 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  20403.9 MiB  12573.8 MiB           1       df = pl.read_csv(dataset_path)
    26   6773.7 MiB  -6540.8 MiB           1       result = (
    27  13329.1 MiB  -7074.8 MiB           1           df.group_by("category_code")
    28  13314.4 MiB  -5679.2 MiB           2           .agg([
    29  12438.0 MiB   -876.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12438.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12438.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   6774.9 MiB      1.2 MiB           1       print(result)


Memory = -1042.83 MB, Time = 13.20 s
Memory Profiler for Run 6/10

------------------------------------------------


*** Run 7/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ apparel.shorts                  ┆ 639     ┆ 11    ┆ 2         │
│ appliances.personal.hair_cutte… ┆ 85361   ┆ 3592  ┆ 1162      │
│ auto.accessories.alarm          ┆ 283328  ┆ 12029 ┆ 3258      │
│ medicine.tools.tonometer        ┆ 20764   ┆ 1274  ┆ 344       │
│ computers.components.memory     ┆ 76162   ┆ 3057  ┆ 876       │
│ …                               ┆ …       ┆ …     ┆ …         │
│ sport.ski                       ┆ 16382   ┆ 267   ┆ 74        │
│ electronics.audio.microphone    ┆ 44645   ┆ 1615  ┆ 489       │
│ appliances.iron                 ┆ 278574  ┆ 14308 ┆ 4650      │
│ construction.tools.drill        ┆ 381287  ┆ 13375 ┆ 3198      │
│ electronics.clocks              ┆ 1994440 ┆ 69289 ┆ 23237     │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   6787.5 MiB   6787.5 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  21380.5 MiB  14593.1 MiB           1       df = pl.read_csv(dataset_path)
    26   7567.3 MiB  -5599.2 MiB           1       result = (
    27  13166.5 MiB  -8214.1 MiB           1           df.group_by("category_code")
    28  13166.5 MiB  -5600.5 MiB           2           .agg([
    29  13167.6 MiB      1.1 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13167.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13167.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7568.2 MiB      0.9 MiB           1       print(result)


Memory = 792.61 MB, Time = 12.51 s
Memory Profiler for Run 7/10

------------------------------------------------


*** Run 8/10 ***

shape: (130, 4)
┌────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                  ┆ views   ┆ carts  ┆ purchases │
│ ---                            ┆ ---     ┆ ---    ┆ ---       │
│ str                            ┆ u32     ┆ u32    ┆ u32       │
╞════════════════════════════════╪═════════╪════════╪═══════════╡
│ construction.tools.generator   ┆ 196994  ┆ 6218   ┆ 1654      │
│ furniture.kitchen.chair        ┆ 180695  ┆ 6286   ┆ 1740      │
│ computers.components.memory    ┆ 76162   ┆ 3057   ┆ 876       │
│ electronics.video.tv           ┆ 2071305 ┆ 106467 ┆ 30274     │
│ country_yard.furniture.hammok  ┆ 1567    ┆ 18     ┆ 4         │
│ …                              ┆ …       ┆ …      ┆ …         │
│ construction.components.faucet ┆ 45919   ┆ 1322   ┆ 388       │
│ electronics.video.projector    ┆ 22423   ┆ 418    ┆ 99        │
│ sport.tennis                   ┆ 7539    ┆ 154    ┆ 48        │
│ sport.ski                      ┆ 16382   ┆ 267    ┆ 74        │
│ construction.tools.light       ┆ 30203   ┆ 493    ┆ 88        │
└────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7580.0 MiB   7580.0 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  12311.9 MiB   4731.9 MiB           1       df = pl.read_csv(dataset_path)
    26   4349.9 MiB  -6124.8 MiB           1       result = (
    27  10474.6 MiB  -1837.3 MiB           1           df.group_by("category_code")
    28  10474.6 MiB  -6126.2 MiB           2           .agg([
    29  10475.9 MiB      1.2 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  10475.9 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  10475.9 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   4350.5 MiB      0.7 MiB           1       print(result)


Memory = -3212.83 MB, Time = 14.74 s
Memory Profiler for Run 8/10

------------------------------------------------


*** Run 9/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ apparel.belt                    ┆ 4527    ┆ 130   ┆ 41        │
│ appliances.environment.vacuum   ┆ 1445029 ┆ 64836 ┆ 18193     │
│ apparel.costume                 ┆ 241589  ┆ 2823  ┆ 879       │
│ computers.components.hdd        ┆ 108021  ┆ 5374  ┆ 1512      │
│ …                               ┆ …       ┆ …     ┆ …         │
│ appliances.personal.scales      ┆ 88564   ┆ 4855  ┆ 1577      │
│ apparel.dress                   ┆ 95954   ┆ 486   ┆ 112       │
│ sport.snowboard                 ┆ 17375   ┆ 423   ┆ 138       │
│ apparel.shoes.espadrilles       ┆ 1404    ┆ 8     ┆ 0         │
│ country_yard.lawn_mower         ┆ 6173    ┆ 180   ┆ 38        │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   4369.2 MiB   4369.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25   8681.2 MiB   4312.1 MiB           1       df = pl.read_csv(dataset_path)
    26   8276.5 MiB      0.0 MiB           1       result = (
    27   7931.9 MiB   -749.3 MiB           1           df.group_by("category_code")
    28   8276.5 MiB    343.5 MiB           2           .agg([
    29   7933.0 MiB      1.1 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30   7933.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31   7933.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   8277.0 MiB      0.5 MiB           1       print(result)


Memory = 3922.33 MB, Time = 18.32 s
Memory Profiler for Run 9/10

------------------------------------------------


*** Run 10/10 ***

shape: (130, 4)
┌─────────────────────────────────┬────────┬───────┬───────────┐
│ category_code                   ┆ views  ┆ carts ┆ purchases │
│ ---                             ┆ ---    ┆ ---   ┆ ---       │
│ str                             ┆ u32    ┆ u32   ┆ u32       │
╞═════════════════════════════════╪════════╪═══════╪═══════════╡
│ appliances.kitchen.hob          ┆ 179125 ┆ 5694  ┆ 1393      │
│ appliances.kitchen.coffee_mach… ┆ 128164 ┆ 2669  ┆ 724       │
│ kids.swing                      ┆ 57430  ┆ 1556  ┆ 482       │
│ apparel.underwear               ┆ 47145  ┆ 483   ┆ 84        │
│ auto.accessories.alarm          ┆ 283328 ┆ 12029 ┆ 3258      │
│ …                               ┆ …      ┆ …     ┆ …         │
│ accessories.umbrella            ┆ 4890   ┆ 73    ┆ 26        │
│ sport.trainer                   ┆ 93430  ┆ 2671  ┆ 693       │
│ construction.tools.generator    ┆ 196994 ┆ 6218  ┆ 1654      │
│ country_yard.lawn_mower         ┆ 6173   ┆ 180   ┆ 38        │
│ computers.peripherals.monitor   ┆ 203806 ┆ 5923  ┆ 1613      │
└─────────────────────────────────┴────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   8291.4 MiB   8291.4 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  19044.9 MiB  10753.5 MiB           1       df = pl.read_csv(dataset_path)
    26   6474.5 MiB  -8867.9 MiB           1       result = (
    27  15342.5 MiB  -3702.4 MiB           1           df.group_by("category_code")
    28  15342.5 MiB  -4325.6 MiB           2           .agg([
    29  10800.0 MiB  -4542.5 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  10800.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  10800.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   6475.2 MiB      0.7 MiB           1       print(result)


Memory = -1798.31 MB, Time = 14.87 s
Memory Profiler for Run 10/10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ------------------------------------------------


*** Run 1/10 ***

┌───────────────────────────────────┬────────┬────────┬───────────┐
│           category_code           │ views  │ carts  │ purchases │
│              varchar              │ int128 │ int128 │  int128   │
├───────────────────────────────────┼────────┼────────┼───────────┤
│ furniture.kitchen.table           │ 192562 │   4246 │      1284 │
│ kids.carriage                     │ 336311 │   8491 │      2674 │
│ computers.peripherals.camera      │   7061 │    194 │        36 │
│ electronics.telephone             │ 327630 │  14832 │      4338 │
│ apparel.shorts                    │    639 │     11 │         2 │
│ apparel.tshirt                    │  21179 │    284 │        93 │
│ construction.components.faucet    │  45919 │   1322 │       388 │
│ computers.components.power_supply │  33989 │   1179 │       346 │
│ apparel.shoes.slipons             │   5552 │     52 │         9 │
│ furniture.universal.light         │  15856 │    185 │        47 │
│           ·                       │    ·   │     ·  │         · │
│           ·                       │    ·   │     ·  │         · │
│           ·                       │    ·   │     ·  │         · │
│ furniture.bedroom.bed             │ 519487 │  10229 │      2957 │
│ appliances.ironing_board          │  60187 │   2744 │       890 │
│ appliances.kitchen.coffee_grinder │  18206 │    559 │       141 │
│ apparel.sock                      │   3455 │    101 │        19 │
│ apparel.costume                   │ 241589 │   2823 │       879 │
│ kids.swing                        │  57430 │   1556 │       482 │
│ auto.accessories.compressor       │  85659 │   2682 │       700 │
│ apparel.scarf                     │   3567 │     43 │         8 │
│ sport.tennis                      │   7539 │    154 │        48 │
│ appliances.kitchen.fryer          │     99 │      8 │         1 │
├───────────────────────────────────┴────────┴────────┴───────────┤
│ 130 rows (20 shown)                                   4 columns │
└─────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    142.8 MiB    142.8 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    179.8 MiB     37.0 MiB           2       duckdb.sql(
    25    142.8 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    142.8 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    353.0 MiB    173.1 MiB           1       ).show()


Memory = 210.41 MB, Time = 2.52 s
Memory Profiler for Run 1/10

------------------------------------------------


*** Run 2/10 ***

┌───────────────────────────────────┬────────┬────────┬───────────┐
│           category_code           │ views  │ carts  │ purchases │
│              varchar              │ int128 │ int128 │  int128   │
├───────────────────────────────────┼────────┼────────┼───────────┤
│ electronics.telephone             │ 327630 │  14832 │      4338 │
│ furniture.universal.light         │  15856 │    185 │        47 │
│ computers.components.power_supply │  33989 │   1179 │       346 │
│ furniture.kitchen.table           │ 192562 │   4246 │      1284 │
│ kids.carriage                     │ 336311 │   8491 │      2674 │
│ construction.components.faucet    │  45919 │   1322 │       388 │
│ apparel.tshirt                    │  21179 │    284 │        93 │
│ apparel.shoes.slipons             │   5552 │     52 │         9 │
│ computers.peripherals.camera      │   7061 │    194 │        36 │
│ apparel.shorts                    │    639 │     11 │         2 │
│       ·                           │     ·  │      · │         · │
│       ·                           │     ·  │      · │         · │
│       ·                           │     ·  │      · │         · │
│ auto.accessories.videoregister    │ 267878 │   9168 │      2313 │
│ furniture.living_room.cabinet     │ 539983 │   9024 │      2635 │
│ furniture.kitchen.chair           │ 180695 │   6286 │      1740 │
│ kids.fmcg.diapers                 │  29296 │   2463 │       819 │
│ computers.ebooks                  │  45761 │   1870 │       434 │
│ appliances.kitchen.microwave      │ 285186 │  15938 │      5146 │
│ construction.tools.painting       │  19791 │    449 │       109 │
│ appliances.kitchen.steam_cooker   │  18856 │    578 │       207 │
│ apparel.skirt                     │   8766 │     61 │        10 │
│ country_yard.furniture.bench      │      2 │      0 │         0 │
├───────────────────────────────────┴────────┴────────┴───────────┤
│ 130 rows (20 shown)                                   4 columns │
└─────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    353.0 MiB    353.0 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    353.0 MiB      0.1 MiB           2       duckdb.sql(
    25    353.0 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    353.0 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    357.3 MiB      4.3 MiB           1       ).show()


Memory = 4.36 MB, Time = 2.33 s
Memory Profiler for Run 2/10

------------------------------------------------


*** Run 3/10 ***

┌─────────────────────────────────┬────────┬────────┬───────────┐
│          category_code          │ views  │ carts  │ purchases │
│             varchar             │ int128 │ int128 │  int128   │
├─────────────────────────────────┼────────┼────────┼───────────┤
│ furniture.living_room.sofa      │ 417428 │   6521 │      1562 │
│ apparel.shirt                   │  50460 │    513 │       122 │
│ appliances.kitchen.meat_grinder │ 242604 │  10737 │      3010 │
│ computers.components.memory     │  76162 │   3057 │       876 │
│ appliances.kitchen.hood         │ 191699 │   5874 │      1484 │
│ auto.accessories.winch          │   5876 │     56 │        20 │
│ medicine.tools.tonometer        │  20764 │   1274 │       344 │
│ electronics.video.projector     │  22423 │    418 │        99 │
│ sport.snowboard                 │  17375 │    423 │       138 │
│ auto.accessories.anti_freeze    │   3397 │     96 │        18 │
│              ·                  │     ·  │      · │         · │
│              ·                  │     ·  │      · │         · │
│              ·                  │     ·  │      · │         · │
│ auto.accessories.videoregister  │ 267878 │   9168 │      2313 │
│ furniture.living_room.cabinet   │ 539983 │   9024 │      2635 │
│ furniture.kitchen.chair         │ 180695 │   6286 │      1740 │
│ kids.fmcg.diapers               │  29296 │   2463 │       819 │
│ computers.ebooks                │  45761 │   1870 │       434 │
│ appliances.kitchen.microwave    │ 285186 │  15938 │      5146 │
│ construction.tools.painting     │  19791 │    449 │       109 │
│ appliances.kitchen.steam_cooker │  18856 │    578 │       207 │
│ country_yard.furniture.bench    │      2 │      0 │         0 │
│ apparel.skirt                   │   8766 │     61 │        10 │
├─────────────────────────────────┴────────┴────────┴───────────┤
│ 130 rows (20 shown)                                 4 columns │
└───────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    357.3 MiB    357.3 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    357.4 MiB      0.1 MiB           2       duckdb.sql(
    25    357.3 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    357.3 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    360.1 MiB      2.7 MiB           1       ).show()


Memory = 2.83 MB, Time = 2.32 s
Memory Profiler for Run 3/10

------------------------------------------------


*** Run 4/10 ***

┌─────────────────────────────────────┬─────────┬────────┬───────────┐
│            category_code            │  views  │ carts  │ purchases │
│               varchar               │ int128  │ int128 │  int128   │
├─────────────────────────────────────┼─────────┼────────┼───────────┤
│ appliances.iron                     │  278574 │  14308 │      4650 │
│ auto.accessories.radar              │   47145 │   2213 │       544 │
│ appliances.kitchen.dishwasher       │  156018 │   3896 │      1018 │
│ electronics.audio.music_tools.piano │   60363 │   2280 │       696 │
│ appliances.kitchen.juicer           │   71894 │   2501 │       733 │
│ appliances.environment.fan          │    3316 │     81 │        32 │
│ apparel.shoes.step_ins              │    1750 │     19 │         7 │
│ apparel.glove                       │    3737 │     70 │        17 │
│ apparel.jacket                      │       1 │      0 │         0 │
│ appliances.kitchen.refrigerators    │ 1362018 │  52102 │     13042 │
│               ·                     │     ·   │     ·  │        ·  │
│               ·                     │     ·   │     ·  │        ·  │
│               ·                     │     ·   │     ·  │        ·  │
│ furniture.living_room.cabinet       │  539983 │   9024 │      2635 │
│ furniture.kitchen.chair             │  180695 │   6286 │      1740 │
│ appliances.kitchen.microwave        │  285186 │  15938 │      5146 │
│ construction.tools.painting         │   19791 │    449 │       109 │
│ computers.ebooks                    │   45761 │   1870 │       434 │
│ kids.fmcg.diapers                   │   29296 │   2463 │       819 │
│ appliances.personal.scales          │   88564 │   4855 │      1577 │
│ appliances.kitchen.steam_cooker     │   18856 │    578 │       207 │
│ apparel.skirt                       │    8766 │     61 │        10 │
│ country_yard.furniture.bench        │       2 │      0 │         0 │
├─────────────────────────────────────┴─────────┴────────┴───────────┤
│ 130 rows (20 shown)                                      4 columns │
└────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    360.2 MiB    360.2 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    360.2 MiB      0.0 MiB           2       duckdb.sql(
    25    360.2 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    360.2 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    362.4 MiB      2.2 MiB           1       ).show()


Memory = 2.28 MB, Time = 2.34 s
Memory Profiler for Run 4/10

------------------------------------------------


*** Run 5/10 ***

┌─────────────────────────────────────┬─────────┬────────┬───────────┐
│            category_code            │  views  │ carts  │ purchases │
│               varchar               │ int128  │ int128 │  int128   │
├─────────────────────────────────────┼─────────┼────────┼───────────┤
│ kids.carriage                       │  336311 │   8491 │      2674 │
│ electronics.telephone               │  327630 │  14832 │      4338 │
│ furniture.kitchen.table             │  192562 │   4246 │      1284 │
│ apparel.tshirt                      │   21179 │    284 │        93 │
│ computers.components.power_supply   │   33989 │   1179 │       346 │
│ furniture.universal.light           │   15856 │    185 │        47 │
│ apparel.shoes.slipons               │    5552 │     52 │         9 │
│ construction.components.faucet      │   45919 │   1322 │       388 │
│ apparel.shorts                      │     639 │     11 │         2 │
│ computers.peripherals.camera        │    7061 │    194 │        36 │
│              ·                      │      ·  │     ·  │         · │
│              ·                      │      ·  │     ·  │         · │
│              ·                      │      ·  │     ·  │         · │
│ appliances.environment.water_heater │  194075 │  11914 │      3382 │
│ computers.components.motherboard    │   74169 │   1650 │       441 │
│ construction.tools.soldering        │    3481 │     39 │         6 │
│ appliances.kitchen.refrigerators    │ 1362018 │  52102 │     13042 │
│ computers.components.cpu            │   81644 │   2139 │       510 │
│ construction.tools.saw              │  185580 │   7488 │      1810 │
│ auto.accessories.parktronic         │   14337 │    271 │        73 │
│ appliances.kitchen.toster           │   38960 │   1707 │       525 │
│ appliances.personal.massager        │   42291 │   1468 │       522 │
│ apparel.shoes.ballet_shoes          │    4299 │     58 │        22 │
├─────────────────────────────────────┴─────────┴────────┴───────────┤
│ 130 rows (20 shown)                                      4 columns │
└────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    362.4 MiB    362.4 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    363.4 MiB      1.0 MiB           2       duckdb.sql(
    25    362.4 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    362.4 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    365.6 MiB      2.2 MiB           1       ).show()


Memory = 3.17 MB, Time = 2.35 s
Memory Profiler for Run 5/10

------------------------------------------------


*** Run 6/10 ***

┌───────────────────────────────────┬──────────┬─────────┬───────────┐
│           category_code           │  views   │  carts  │ purchases │
│              varchar              │  int128  │ int128  │  int128   │
├───────────────────────────────────┼──────────┼─────────┼───────────┤
│ electronics.telephone             │   327630 │   14832 │      4338 │
│ furniture.universal.light         │    15856 │     185 │        47 │
│ computers.components.power_supply │    33989 │    1179 │       346 │
│ furniture.kitchen.table           │   192562 │    4246 │      1284 │
│ kids.carriage                     │   336311 │    8491 │      2674 │
│ construction.components.faucet    │    45919 │    1322 │       388 │
│ apparel.tshirt                    │    21179 │     284 │        93 │
│ apparel.shoes.slipons             │     5552 │      52 │         9 │
│ computers.peripherals.camera      │     7061 │     194 │        36 │
│ apparel.shorts                    │      639 │      11 │         2 │
│       ·                           │       ·  │       · │         · │
│       ·                           │       ·  │       · │         · │
│       ·                           │       ·  │       · │         · │
│ appliances.kitchen.coffee_grinder │    18206 │     559 │       141 │
│ appliances.kitchen.grill          │   116721 │    3602 │      1086 │
│ construction.tools.pump           │    41675 │    1568 │       326 │
│ stationery.cartrige               │    11943 │     644 │       191 │
│ electronics.smartphone            │ 14832387 │ 1159966 │    382647 │
│ appliances.kitchen.washer         │  1313807 │   70287 │     19772 │
│ appliances.kitchen.coffee_machine │   128164 │    2669 │       724 │
│ computers.components.videocards   │   147797 │    4588 │      1129 │
│ apparel.dress                     │    95954 │     486 │       112 │
│ accessories.umbrella              │     4890 │      73 │        26 │
├───────────────────────────────────┴──────────┴─────────┴───────────┤
│ 130 rows (20 shown)                                      4 columns │
└────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    365.6 MiB    365.6 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    365.7 MiB      0.1 MiB           2       duckdb.sql(
    25    365.6 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    365.6 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    398.6 MiB     33.0 MiB           1       ).show()


Memory = 33.02 MB, Time = 2.34 s
Memory Profiler for Run 6/10

------------------------------------------------


*** Run 7/10 ***

┌────────────────────────────────────────┬──────────┬────────┬───────────┐
│             category_code              │  views   │ carts  │ purchases │
│                varchar                 │  int128  │ int128 │  int128   │
├────────────────────────────────────────┼──────────┼────────┼───────────┤
│ furniture.bedroom.bed                  │   519487 │  10229 │      2957 │
│ appliances.ironing_board               │    60187 │   2744 │       890 │
│ apparel.sock                           │     3455 │    101 │        19 │
│ kids.dolls                             │    86219 │   1710 │       437 │
│ appliances.environment.air_conditioner │    97701 │   3046 │       785 │
│ appliances.kitchen.coffee_grinder      │    18206 │    559 │       141 │
│ computers.desktop                      │   673875 │  12846 │      3781 │
│ kids.toys                              │   199612 │   4992 │      1370 │
│ NULL                                   │ 20837460 │ 826493 │    234218 │
│ appliances.environment.vacuum          │  1445029 │  64836 │     18193 │
│       ·                                │        · │      · │         · │
│       ·                                │        · │      · │         · │
│       ·                                │        · │      · │         · │
│ apparel.jacket                         │        1 │      0 │         0 │
│ appliances.kitchen.blender             │   317090 │  14058 │      4042 │
│ accessories.bag                        │   306574 │   6319 │      1762 │
│ apparel.shoes.keds                     │   475966 │   7566 │      2270 │
│ construction.tools.generator           │   196994 │   6218 │      1654 │
│ computers.components.hdd               │   108021 │   5374 │      1512 │
│ country_yard.cultivator                │     9557 │    162 │        18 │
│ construction.tools.light               │    30203 │    493 │        88 │
│ furniture.bedroom.pillow               │    28175 │    870 │       189 │
│ country_yard.furniture.hammok          │     1567 │     18 │         4 │
├────────────────────────────────────────┴──────────┴────────┴───────────┤
│ 130 rows (20 shown)                                          4 columns │
└────────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    398.6 MiB    398.6 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    398.6 MiB      0.0 MiB           2       duckdb.sql(
    25    398.6 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    398.6 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    461.8 MiB     63.1 MiB           1       ).show()


Memory = 63.14 MB, Time = 2.44 s
Memory Profiler for Run 7/10

------------------------------------------------


*** Run 8/10 ***

┌───────────────────────────────────┬─────────┬────────┬───────────┐
│           category_code           │  views  │ carts  │ purchases │
│              varchar              │ int128  │ int128 │  int128   │
├───────────────────────────────────┼─────────┼────────┼───────────┤
│ kids.carriage                     │  336311 │   8491 │      2674 │
│ electronics.telephone             │  327630 │  14832 │      4338 │
│ furniture.kitchen.table           │  192562 │   4246 │      1284 │
│ apparel.tshirt                    │   21179 │    284 │        93 │
│ construction.components.faucet    │   45919 │   1322 │       388 │
│ computers.components.power_supply │   33989 │   1179 │       346 │
│ apparel.shorts                    │     639 │     11 │         2 │
│ computers.peripherals.camera      │    7061 │    194 │        36 │
│ furniture.universal.light         │   15856 │    185 │        47 │
│ apparel.shoes.slipons             │    5552 │     52 │         9 │
│           ·                       │      ·  │      · │         · │
│           ·                       │      ·  │      · │         · │
│           ·                       │      ·  │      · │         · │
│ appliances.kitchen.oven           │  362455 │  13149 │      3734 │
│ computers.components.motherboard  │   74169 │   1650 │       441 │
│ construction.tools.soldering      │    3481 │     39 │         6 │
│ construction.tools.saw            │  185580 │   7488 │      1810 │
│ appliances.kitchen.refrigerators  │ 1362018 │  52102 │     13042 │
│ appliances.personal.massager      │   42291 │   1468 │       522 │
│ computers.components.cpu          │   81644 │   2139 │       510 │
│ appliances.kitchen.toster         │   38960 │   1707 │       525 │
│ auto.accessories.parktronic       │   14337 │    271 │        73 │
│ apparel.shoes.ballet_shoes        │    4299 │     58 │        22 │
├───────────────────────────────────┴─────────┴────────┴───────────┤
│ 130 rows (20 shown)                                    4 columns │
└──────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    461.8 MiB    461.8 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    461.8 MiB      0.0 MiB           2       duckdb.sql(
    25    461.8 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    461.8 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    463.5 MiB      1.7 MiB           1       ).show()


Memory = 1.70 MB, Time = 2.36 s
Memory Profiler for Run 8/10

------------------------------------------------


*** Run 9/10 ***

┌─────────────────────────────────────┬──────────┬─────────┬───────────┐
│            category_code            │  views   │  carts  │ purchases │
│               varchar               │  int128  │ int128  │  int128   │
├─────────────────────────────────────┼──────────┼─────────┼───────────┤
│ appliances.iron                     │   278574 │   14308 │      4650 │
│ electronics.audio.music_tools.piano │    60363 │    2280 │       696 │
│ appliances.kitchen.juicer           │    71894 │    2501 │       733 │
│ auto.accessories.radar              │    47145 │    2213 │       544 │
│ appliances.kitchen.dishwasher       │   156018 │    3896 │      1018 │
│ appliances.environment.fan          │     3316 │      81 │        32 │
│ apparel.shoes.step_ins              │     1750 │      19 │         7 │
│ apparel.glove                       │     3737 │      70 │        17 │
│ apparel.jacket                      │        1 │       0 │         0 │
│ appliances.kitchen.refrigerators    │  1362018 │   52102 │     13042 │
│       ·                             │     ·    │     ·   │       ·   │
│       ·                             │     ·    │     ·   │       ·   │
│       ·                             │     ·    │     ·   │       ·   │
│ apparel.shoes                       │  1836676 │   40074 │     10140 │
│ computers.desktop                   │   673875 │   12846 │      3781 │
│ kids.toys                           │   199612 │    4992 │      1370 │
│ kids.skates                         │    70649 │    1489 │       384 │
│ electronics.smartphone              │ 14832387 │ 1159966 │    382647 │
│ appliances.kitchen.washer           │  1313807 │   70287 │     19772 │
│ computers.components.videocards     │   147797 │    4588 │      1129 │
│ appliances.kitchen.coffee_machine   │   128164 │    2669 │       724 │
│ accessories.umbrella                │     4890 │      73 │        26 │
│ apparel.dress                       │    95954 │     486 │       112 │
├─────────────────────────────────────┴──────────┴─────────┴───────────┤
│ 130 rows (20 shown)                                        4 columns │
└──────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    463.5 MiB    463.5 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    463.5 MiB      0.0 MiB           2       duckdb.sql(
    25    463.5 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    463.5 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    464.8 MiB      1.3 MiB           1       ).show()


Memory = 1.30 MB, Time = 2.46 s
Memory Profiler for Run 9/10

------------------------------------------------


*** Run 10/10 ***

┌───────────────────────────────────┬──────────┬─────────┬───────────┐
│           category_code           │  views   │  carts  │ purchases │
│              varchar              │  int128  │ int128  │  int128   │
├───────────────────────────────────┼──────────┼─────────┼───────────┤
│ appliances.kitchen.grill          │   116721 │    3602 │      1086 │
│ stationery.cartrige               │    11943 │     644 │       191 │
│ construction.tools.pump           │    41675 │    1568 │       326 │
│ computers.peripherals.printer     │   209130 │    9900 │      2698 │
│ electronics.audio.acoustic        │   137239 │    3630 │      1153 │
│ appliances.kitchen.mixer          │   140422 │    5719 │      1724 │
│ computers.peripherals.mouse       │   109467 │    5002 │      1321 │
│ auto.accessories.alarm            │   283328 │   12029 │      3258 │
│ country_yard.lawn_mower           │     6173 │     180 │        38 │
│ furniture.bedroom.blanket         │    28269 │     657 │       214 │
│         ·                         │      ·   │      ·  │        ·  │
│         ·                         │      ·   │      ·  │        ·  │
│         ·                         │      ·   │      ·  │        ·  │
│ computers.desktop                 │   673875 │   12846 │      3781 │
│ appliances.environment.vacuum     │  1445029 │   64836 │     18193 │
│ kids.skates                       │    70649 │    1489 │       384 │
│ kids.toys                         │   199612 │    4992 │      1370 │
│ electronics.smartphone            │ 14832387 │ 1159966 │    382647 │
│ computers.components.videocards   │   147797 │    4588 │      1129 │
│ appliances.kitchen.washer         │  1313807 │   70287 │     19772 │
│ appliances.kitchen.coffee_machine │   128164 │    2669 │       724 │
│ apparel.dress                     │    95954 │     486 │       112 │
│ accessories.umbrella              │     4890 │      73 │        26 │
├───────────────────────────────────┴──────────┴─────────┴───────────┤
│ 130 rows (20 shown)                                      4 columns │
└────────────────────────────────────────────────────────────────────┘

Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22    464.8 MiB    464.8 MiB           1   @profile
    23                                         def grouping_conditional_aggregation():
    24    464.8 MiB      0.0 MiB           2       duckdb.sql(
    25    464.8 MiB      0.0 MiB           2           f"""
    26                                                 SELECT
    27                                                     category_code,
    28                                                     SUM(CASE WHEN event_type = 'view' THEN 1 ELSE 0 END) AS views,
    29                                                     SUM(CASE WHEN event_type = 'cart' THEN 1 ELSE 0 END) AS carts,
    30                                                     SUM(CASE WHEN event_type = 'purchase' THEN 1 ELSE 0 END) AS purchases
    31    464.8 MiB      0.0 MiB           1           FROM read_csv_auto('{dataset_path}')
    32                                                 GROUP BY category_code
    33                                                 """
    34    466.6 MiB      1.8 MiB           1       ).show()


Memory = 1.84 MB, Time = 2.38 s
Memory Profiler for Run 10/10

------------------------------------------------


Benchmark for grouping_conditional_aggregation with duckdb finished!


--- Elapsed Time (s) ---
Mean:   2.38
Std:    0.07
CV:     2.8%
Min:    2.32
Max:    2.52
Span:   0.20

--- Memory Used (MB) ---
Mean:   32.41
Std:    65.74
CV:     202.9%
Min:    1.30
Max:    210.41
Span:   209.11

-----------------------------------------------

Benchmark for grouping_conditional_aggregation with polars started!
------------------------------------------------


*** Run 1/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                   ┆ views   ┆ carts  ┆ purchases │
│ ---                             ┆ ---     ┆ ---    ┆ ---       │
│ str                             ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════════╪═════════╪════════╪═══════════╡
│ appliances.kitchen.steam_cooke… ┆ 18856   ┆ 578    ┆ 207       │
│ appliances.kitchen.mixer        ┆ 140422  ┆ 5719   ┆ 1724      │
│ computers.notebook              ┆ 2103024 ┆ 59097  ┆ 18433     │
│ medicine.tools.tonometer        ┆ 20764   ┆ 1274   ┆ 344       │
│ electronics.audio.headphone     ┆ 1644910 ┆ 131133 ┆ 40834     │
│ …                               ┆ …       ┆ …      ┆ …         │
│ electronics.camera.photo        ┆ 18963   ┆ 710    ┆ 211       │
│ construction.tools.screw        ┆ 182     ┆ 1      ┆ 1         │
│ auto.accessories.winch          ┆ 5876    ┆ 56     ┆ 20        │
│ construction.tools.saw          ┆ 185580  ┆ 7488   ┆ 1810      │
│ sport.snowboard                 ┆ 17375   ┆ 423    ┆ 138       │
└─────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23    142.2 MiB    142.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  20983.0 MiB  20840.8 MiB           1       df = pl.read_csv(dataset_path)
    26   7356.6 MiB -13594.4 MiB           1       result = (
    27  20951.0 MiB    -32.0 MiB           1           df.group_by("category_code")
    28  20951.0 MiB  -5037.1 MiB           2           .agg([
    29  12393.6 MiB  -8557.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12393.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12393.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7356.8 MiB      0.3 MiB           1       print(result)


Memory = 7222.69 MB, Time = 6.68 s
Memory Profiler for Run 1/10

------------------------------------------------


*** Run 2/10 ***

shape: (130, 4)
┌─────────────────────────────┬─────────┬────────┬───────────┐
│ category_code               ┆ views   ┆ carts  ┆ purchases │
│ ---                         ┆ ---     ┆ ---    ┆ ---       │
│ str                         ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════╪═════════╪════════╪═══════════╡
│ appliances.iron             ┆ 278574  ┆ 14308  ┆ 4650      │
│ electronics.camera.photo    ┆ 18963   ┆ 710    ┆ 211       │
│ appliances.kitchen.fryer    ┆ 99      ┆ 8      ┆ 1         │
│ electronics.camera.video    ┆ 63819   ┆ 1616   ┆ 393       │
│ auto.accessories.winch      ┆ 5876    ┆ 56     ┆ 20        │
│ …                           ┆ …       ┆ …      ┆ …         │
│ country_yard.lawn_mower     ┆ 6173    ┆ 180    ┆ 38        │
│ electronics.audio.headphone ┆ 1644910 ┆ 131133 ┆ 40834     │
│ furniture.kitchen.chair     ┆ 180695  ┆ 6286   ┆ 1740      │
│ appliances.kitchen.hob      ┆ 179125  ┆ 5694   ┆ 1393      │
│ auto.accessories.alarm      ┆ 283328  ┆ 12029  ┆ 3258      │
└─────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7364.8 MiB   7364.8 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  14087.2 MiB   6722.4 MiB           1       df = pl.read_csv(dataset_path)
    26   7469.5 MiB  -6073.7 MiB           1       result = (
    27  13543.2 MiB   -544.0 MiB           1           df.group_by("category_code")
    28  13543.2 MiB  -4140.2 MiB           2           .agg([
    29  11609.7 MiB  -1933.5 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  11609.7 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  11609.7 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7469.9 MiB      0.4 MiB           1       print(result)


Memory = 116.27 MB, Time = 11.25 s
Memory Profiler for Run 2/10

------------------------------------------------


*** Run 3/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                   ┆ views   ┆ carts  ┆ purchases │
│ ---                             ┆ ---     ┆ ---    ┆ ---       │
│ str                             ┆ u32     ┆ u32    ┆ u32       │
╞═════════════════════════════════╪═════════╪════════╪═══════════╡
│ computers.notebook              ┆ 2103024 ┆ 59097  ┆ 18433     │
│ kids.skates                     ┆ 70649   ┆ 1489   ┆ 384       │
│ electronics.camera.photo        ┆ 18963   ┆ 710    ┆ 211       │
│ electronics.video.tv            ┆ 2071305 ┆ 106467 ┆ 30274     │
│ auto.accessories.compressor     ┆ 85659   ┆ 2682   ┆ 700       │
│ …                               ┆ …       ┆ …      ┆ …         │
│ computers.components.cooler     ┆ 70234   ┆ 2304   ┆ 640       │
│ appliances.kitchen.refrigerato… ┆ 1362018 ┆ 52102  ┆ 13042     │
│ appliances.environment.water_h… ┆ 194075  ┆ 11914  ┆ 3382      │
│ stationery.cartrige             ┆ 11943   ┆ 644    ┆ 191       │
│ appliances.personal.hair_cutte… ┆ 85361   ┆ 3592   ┆ 1162      │
└─────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7483.0 MiB   7483.0 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  15130.7 MiB   7647.6 MiB           1       df = pl.read_csv(dataset_path)
    26   7112.9 MiB  -7505.8 MiB           1       result = (
    27  14618.7 MiB   -512.0 MiB           1           df.group_by("category_code")
    28  14618.7 MiB  -5329.8 MiB           2           .agg([
    29  12570.7 MiB  -2048.0 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12506.7 MiB    -64.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12442.7 MiB    -64.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7113.5 MiB      0.6 MiB           1       print(result)


Memory = -354.97 MB, Time = 13.95 s
Memory Profiler for Run 3/10

------------------------------------------------


*** Run 4/10 ***

shape: (130, 4)
┌─────────────────────────────────┬──────────┬────────┬───────────┐
│ category_code                   ┆ views    ┆ carts  ┆ purchases │
│ ---                             ┆ ---      ┆ ---    ┆ ---       │
│ str                             ┆ u32      ┆ u32    ┆ u32       │
╞═════════════════════════════════╪══════════╪════════╪═══════════╡
│ auto.accessories.videoregister  ┆ 267878   ┆ 9168   ┆ 2313      │
│ apparel.skirt                   ┆ 8766     ┆ 61     ┆ 10        │
│ computers.components.cooler     ┆ 70234    ┆ 2304   ┆ 640       │
│ construction.tools.soldering    ┆ 3481     ┆ 39     ┆ 6         │
│ appliances.kitchen.meat_grinde… ┆ 242604   ┆ 10737  ┆ 3010      │
│ …                               ┆ …        ┆ …      ┆ …         │
│ electronics.audio.microphone    ┆ 44645    ┆ 1615   ┆ 489       │
│ null                            ┆ 20837460 ┆ 826493 ┆ 234218    │
│ accessories.wallet              ┆ 68909    ┆ 1119   ┆ 366       │
│ kids.skates                     ┆ 70649    ┆ 1489   ┆ 384       │
│ sport.snowboard                 ┆ 17375    ┆ 423    ┆ 138       │
└─────────────────────────────────┴──────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7128.2 MiB   7128.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  21811.5 MiB  14683.3 MiB           1       df = pl.read_csv(dataset_path)
    26   8590.7 MiB  -4790.8 MiB           1       result = (
    27  13381.5 MiB  -8429.9 MiB           1           df.group_by("category_code")
    28  13381.5 MiB  -4791.9 MiB           2           .agg([
    29  13382.6 MiB      1.0 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13382.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13382.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   8591.4 MiB      0.7 MiB           1       print(result)


Memory = 1476.25 MB, Time = 12.60 s
Memory Profiler for Run 4/10

------------------------------------------------


*** Run 5/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ construction.components.faucet  ┆ 45919   ┆ 1322  ┆ 388       │
│ computers.components.cooler     ┆ 70234   ┆ 2304  ┆ 640       │
│ furniture.bedroom.blanket       ┆ 28269   ┆ 657   ┆ 214       │
│ electronics.video.projector     ┆ 22423   ┆ 418   ┆ 99        │
│ computers.components.cpu        ┆ 81644   ┆ 2139  ┆ 510       │
│ …                               ┆ …       ┆ …     ┆ …         │
│ furniture.living_room.sofa      ┆ 417428  ┆ 6521  ┆ 1562      │
│ electronics.clocks              ┆ 1994440 ┆ 69289 ┆ 23237     │
│ furniture.bathroom.toilet       ┆ 28060   ┆ 964   ┆ 213       │
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ construction.tools.welding      ┆ 141960  ┆ 5431  ┆ 1119      │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   8602.7 MiB   8602.7 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  16726.5 MiB   8123.8 MiB           1       df = pl.read_csv(dataset_path)
    26   7817.5 MiB  -8397.0 MiB           1       result = (
    27  16214.5 MiB   -512.0 MiB           1           df.group_by("category_code")
    28  16214.5 MiB  -5791.9 MiB           2           .agg([
    29  13609.1 MiB  -2605.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13609.1 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13609.1 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7818.4 MiB      0.9 MiB           1       print(result)


Memory = -772.59 MB, Time = 12.23 s
Memory Profiler for Run 5/10

------------------------------------------------


*** Run 6/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ appliances.kitchen.washer       ┆ 1313807 ┆ 70287 ┆ 19772     │
│ apparel.jacket                  ┆ 1       ┆ 0     ┆ 0         │
│ sport.tennis                    ┆ 7539    ┆ 154   ┆ 48        │
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ furniture.kitchen.chair         ┆ 180695  ┆ 6286  ┆ 1740      │
│ …                               ┆ …       ┆ …     ┆ …         │
│ country_yard.cultivator         ┆ 9557    ┆ 162   ┆ 18        │
│ computers.notebook              ┆ 2103024 ┆ 59097 ┆ 18433     │
│ construction.tools.pump         ┆ 41675   ┆ 1568  ┆ 326       │
│ apparel.shoes.ballet_shoes      ┆ 4299    ┆ 58    ┆ 22        │
│ electronics.tablet              ┆ 464073  ┆ 22286 ┆ 6138      │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7830.1 MiB   7830.1 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  20403.9 MiB  12573.8 MiB           1       df = pl.read_csv(dataset_path)
    26   6773.7 MiB  -6540.8 MiB           1       result = (
    27  13329.1 MiB  -7074.8 MiB           1           df.group_by("category_code")
    28  13314.4 MiB  -5679.2 MiB           2           .agg([
    29  12438.0 MiB   -876.4 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  12438.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  12438.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   6774.9 MiB      1.2 MiB           1       print(result)


Memory = -1042.83 MB, Time = 13.20 s
Memory Profiler for Run 6/10

------------------------------------------------


*** Run 7/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ apparel.shorts                  ┆ 639     ┆ 11    ┆ 2         │
│ appliances.personal.hair_cutte… ┆ 85361   ┆ 3592  ┆ 1162      │
│ auto.accessories.alarm          ┆ 283328  ┆ 12029 ┆ 3258      │
│ medicine.tools.tonometer        ┆ 20764   ┆ 1274  ┆ 344       │
│ computers.components.memory     ┆ 76162   ┆ 3057  ┆ 876       │
│ …                               ┆ …       ┆ …     ┆ …         │
│ sport.ski                       ┆ 16382   ┆ 267   ┆ 74        │
│ electronics.audio.microphone    ┆ 44645   ┆ 1615  ┆ 489       │
│ appliances.iron                 ┆ 278574  ┆ 14308 ┆ 4650      │
│ construction.tools.drill        ┆ 381287  ┆ 13375 ┆ 3198      │
│ electronics.clocks              ┆ 1994440 ┆ 69289 ┆ 23237     │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   6787.5 MiB   6787.5 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  21380.5 MiB  14593.1 MiB           1       df = pl.read_csv(dataset_path)
    26   7567.3 MiB  -5599.2 MiB           1       result = (
    27  13166.5 MiB  -8214.1 MiB           1           df.group_by("category_code")
    28  13166.5 MiB  -5600.5 MiB           2           .agg([
    29  13167.6 MiB      1.1 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  13167.6 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  13167.6 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   7568.2 MiB      0.9 MiB           1       print(result)


Memory = 792.61 MB, Time = 12.51 s
Memory Profiler for Run 7/10

------------------------------------------------


*** Run 8/10 ***

shape: (130, 4)
┌────────────────────────────────┬─────────┬────────┬───────────┐
│ category_code                  ┆ views   ┆ carts  ┆ purchases │
│ ---                            ┆ ---     ┆ ---    ┆ ---       │
│ str                            ┆ u32     ┆ u32    ┆ u32       │
╞════════════════════════════════╪═════════╪════════╪═══════════╡
│ construction.tools.generator   ┆ 196994  ┆ 6218   ┆ 1654      │
│ furniture.kitchen.chair        ┆ 180695  ┆ 6286   ┆ 1740      │
│ computers.components.memory    ┆ 76162   ┆ 3057   ┆ 876       │
│ electronics.video.tv           ┆ 2071305 ┆ 106467 ┆ 30274     │
│ country_yard.furniture.hammok  ┆ 1567    ┆ 18     ┆ 4         │
│ …                              ┆ …       ┆ …      ┆ …         │
│ construction.components.faucet ┆ 45919   ┆ 1322   ┆ 388       │
│ electronics.video.projector    ┆ 22423   ┆ 418    ┆ 99        │
│ sport.tennis                   ┆ 7539    ┆ 154    ┆ 48        │
│ sport.ski                      ┆ 16382   ┆ 267    ┆ 74        │
│ construction.tools.light       ┆ 30203   ┆ 493    ┆ 88        │
└────────────────────────────────┴─────────┴────────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   7580.0 MiB   7580.0 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  12311.9 MiB   4731.9 MiB           1       df = pl.read_csv(dataset_path)
    26   4349.9 MiB  -6124.8 MiB           1       result = (
    27  10474.6 MiB  -1837.3 MiB           1           df.group_by("category_code")
    28  10474.6 MiB  -6126.2 MiB           2           .agg([
    29  10475.9 MiB      1.2 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  10475.9 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  10475.9 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   4350.5 MiB      0.7 MiB           1       print(result)


Memory = -3212.83 MB, Time = 14.74 s
Memory Profiler for Run 8/10

------------------------------------------------


*** Run 9/10 ***

shape: (130, 4)
┌─────────────────────────────────┬─────────┬───────┬───────────┐
│ category_code                   ┆ views   ┆ carts ┆ purchases │
│ ---                             ┆ ---     ┆ ---   ┆ ---       │
│ str                             ┆ u32     ┆ u32   ┆ u32       │
╞═════════════════════════════════╪═════════╪═══════╪═══════════╡
│ computers.components.videocard… ┆ 147797  ┆ 4588  ┆ 1129      │
│ apparel.belt                    ┆ 4527    ┆ 130   ┆ 41        │
│ appliances.environment.vacuum   ┆ 1445029 ┆ 64836 ┆ 18193     │
│ apparel.costume                 ┆ 241589  ┆ 2823  ┆ 879       │
│ computers.components.hdd        ┆ 108021  ┆ 5374  ┆ 1512      │
│ …                               ┆ …       ┆ …     ┆ …         │
│ appliances.personal.scales      ┆ 88564   ┆ 4855  ┆ 1577      │
│ apparel.dress                   ┆ 95954   ┆ 486   ┆ 112       │
│ sport.snowboard                 ┆ 17375   ┆ 423   ┆ 138       │
│ apparel.shoes.espadrilles       ┆ 1404    ┆ 8     ┆ 0         │
│ country_yard.lawn_mower         ┆ 6173    ┆ 180   ┆ 38        │
└─────────────────────────────────┴─────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   4369.2 MiB   4369.2 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25   8681.2 MiB   4312.1 MiB           1       df = pl.read_csv(dataset_path)
    26   8276.5 MiB      0.0 MiB           1       result = (
    27   7931.9 MiB   -749.3 MiB           1           df.group_by("category_code")
    28   8276.5 MiB    343.5 MiB           2           .agg([
    29   7933.0 MiB      1.1 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30   7933.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31   7933.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   8277.0 MiB      0.5 MiB           1       print(result)


Memory = 3922.33 MB, Time = 18.32 s
Memory Profiler for Run 9/10

------------------------------------------------


*** Run 10/10 ***

shape: (130, 4)
┌─────────────────────────────────┬────────┬───────┬───────────┐
│ category_code                   ┆ views  ┆ carts ┆ purchases │
│ ---                             ┆ ---    ┆ ---   ┆ ---       │
│ str                             ┆ u32    ┆ u32   ┆ u32       │
╞═════════════════════════════════╪════════╪═══════╪═══════════╡
│ appliances.kitchen.hob          ┆ 179125 ┆ 5694  ┆ 1393      │
│ appliances.kitchen.coffee_mach… ┆ 128164 ┆ 2669  ┆ 724       │
│ kids.swing                      ┆ 57430  ┆ 1556  ┆ 482       │
│ apparel.underwear               ┆ 47145  ┆ 483   ┆ 84        │
│ auto.accessories.alarm          ┆ 283328 ┆ 12029 ┆ 3258      │
│ …                               ┆ …      ┆ …     ┆ …         │
│ accessories.umbrella            ┆ 4890   ┆ 73    ┆ 26        │
│ sport.trainer                   ┆ 93430  ┆ 2671  ┆ 693       │
│ construction.tools.generator    ┆ 196994 ┆ 6218  ┆ 1654      │
│ country_yard.lawn_mower         ┆ 6173   ┆ 180   ┆ 38        │
│ computers.peripherals.monitor   ┆ 203806 ┆ 5923  ┆ 1613      │
└─────────────────────────────────┴────────┴───────┴───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    23   8291.4 MiB   8291.4 MiB           1   @profile
    24                                         def grouping_conditional_aggregation():
    25  19044.9 MiB  10753.5 MiB           1       df = pl.read_csv(dataset_path)
    26   6474.5 MiB  -8867.9 MiB           1       result = (
    27  15342.5 MiB  -3702.4 MiB           1           df.group_by("category_code")
    28  15342.5 MiB  -4325.6 MiB           2           .agg([
    29  10800.0 MiB  -4542.5 MiB           1               (pl.col("event_type") == "view").sum().alias("views"),
    30  10800.0 MiB      0.0 MiB           1               (pl.col("event_type") == "cart").sum().alias("carts"),
    31  10800.0 MiB      0.0 MiB           1               (pl.col("event_type") == "purchase").sum().alias("purchases"),
    32                                                 ])
    33                                             )
    34   6475.2 MiB      0.7 MiB           1       print(result)


Memory = -1798.31 MB, Time = 14.87 s
Memory Profiler for Run 10/10

------------------------------------------------


Benchmark for grouping_conditional_aggregation with polars finished!


--- Elapsed Time (s) ---
Mean:   13.04
Std:    2.98
CV:     22.8%
Min:    6.68
Max:    18.32
Span:   11.64

--- Memory Used (MB) ---
Mean:   634.86
Std:    3013.10
CV:     474.6%
Min:    -3212.83
Max:    7222.69
Span:   10435.52

Benchmark-Comparison for grouping_conditional_aggregation with Pandas, Duckdb, Polars in hot mode with 10 runs finished.

Figure saved as results/pandas_duckdb_polars_grouping_conditional_aggregation_hot.png
Figure saved as results/pandas_duckdb_polars_grouping_conditional_aggregation_hot_bar.png
Figure saved as results/duckdb_polars_grouping_conditional_aggregation_hot.png
Figure saved as results/pandas_duckdb_polars_grouping_conditional_aggregation_hot_cold_bar.png
