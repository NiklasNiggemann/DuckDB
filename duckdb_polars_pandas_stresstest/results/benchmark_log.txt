
=== Phase 1: Running benchmarks ===

[START] polars

------------------------------------------------

[STRESS-SMALL] Reading 100 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 113926400 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.0 MiB     71.0 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.1 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.1 MiB      0.0 MiB         102           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   1239.8 MiB    860.6 MiB           3       df = pl.SQLContext().execute(
    28     71.1 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.1 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.1 MiB      0.0 MiB           1           eager=False
    37   1239.8 MiB    308.1 MiB           1       ).collect(engine="streaming")
    38   1239.9 MiB      0.2 MiB           1       print(df)


Memory = 1168.98 MB, Time = 13.30 s

------------------------------------------------

[STRESS-SMALL] Reading 200 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 227852800 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.2 MiB     71.2 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.3 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.2 MiB      0.0 MiB         202           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   2104.2 MiB   1716.1 MiB           3       df = pl.SQLContext().execute(
    28     71.3 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.3 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.3 MiB      0.0 MiB           1           eager=False
    37   2104.2 MiB    316.8 MiB           1       ).collect(engine="streaming")
    38   2104.3 MiB      0.2 MiB           1       print(df)


Memory = 2033.25 MB, Time = 27.10 s

------------------------------------------------

[STRESS-SMALL] Reading 300 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 341779200 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.5 MiB     71.5 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.5 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.5 MiB      0.0 MiB         302           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   2984.2 MiB   2571.9 MiB           3       df = pl.SQLContext().execute(
    28     71.6 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.6 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.6 MiB      0.0 MiB           1           eager=False
    37   2984.2 MiB    340.8 MiB           1       ).collect(engine="streaming")
    38   2984.3 MiB      0.2 MiB           1       print(df)


Memory = 2912.97 MB, Time = 40.12 s

------------------------------------------------

[STRESS-SMALL] Reading 400 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 455705600 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.2 MiB     71.2 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.3 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.3 MiB      0.1 MiB         402           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   3852.6 MiB   3427.4 MiB           3       df = pl.SQLContext().execute(
    28     71.4 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.4 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.4 MiB      0.0 MiB           1           eager=False
    37   3852.6 MiB    353.8 MiB           1       ).collect(engine="streaming")
    38   3852.7 MiB      0.2 MiB           1       print(df)


Memory = 3781.58 MB, Time = 53.13 s

------------------------------------------------

[STRESS-SMALL] Reading 500 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 569632000 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.3 MiB     71.3 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.3 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.3 MiB      0.1 MiB         502           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   4727.3 MiB   4282.3 MiB           3       df = pl.SQLContext().execute(
    28     71.4 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.4 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.4 MiB      0.0 MiB           1           eager=False
    37   4727.3 MiB    373.6 MiB           1       ).collect(engine="streaming")
    38   4727.5 MiB      0.2 MiB           1       print(df)


Memory = 4656.34 MB, Time = 65.95 s

------------------------------------------------

[STRESS-SMALL] Reading 600 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 683558400 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.3 MiB     71.3 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.4 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.4 MiB      0.1 MiB         602           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   5596.0 MiB   5138.2 MiB           3       df = pl.SQLContext().execute(
    28     71.5 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.5 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.5 MiB      0.0 MiB           1           eager=False
    37   5596.0 MiB    386.4 MiB           1       ).collect(engine="streaming")
    38   5596.1 MiB      0.2 MiB           1       print(df)


Memory = 5524.92 MB, Time = 78.31 s

------------------------------------------------

[STRESS-SMALL] Reading 700 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 797484800 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.4 MiB     71.4 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.5 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.5 MiB      0.1 MiB         702           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   6462.4 MiB   5993.4 MiB           3       df = pl.SQLContext().execute(
    28     71.5 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.5 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.5 MiB      0.0 MiB           1           eager=False
    37   6462.4 MiB    397.6 MiB           1       ).collect(engine="streaming")
    38   6462.6 MiB      0.2 MiB           1       print(df)


Memory = 6391.28 MB, Time = 92.14 s

------------------------------------------------

[STRESS-SMALL] Reading 800 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 911411200 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.0 MiB     71.0 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.1 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.1 MiB      0.1 MiB         802           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   7335.4 MiB   6849.6 MiB           3       df = pl.SQLContext().execute(
    28     71.2 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.2 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.2 MiB      0.0 MiB           1           eager=False
    37   7335.4 MiB    414.7 MiB           1       ).collect(engine="streaming")
    38   7335.6 MiB      0.2 MiB           1       print(df)


Memory = 7264.64 MB, Time = 109.50 s

--- Elapsed Time (s) ---
Mean:   59.94
Std:    32.86
CV:     54.8%
Min:    13.30
Max:    109.50
Span:   96.20

------------------------------------------------

--- Memory Used (MB) ---
Mean:   4216.74
Std:    2133.69
CV:     50.6%
Min:    1168.98
Max:    7264.64
Span:   6095.66

------------------------------------------------

[START] duckdb

------------------------------------------------

[STRESS-SMALL] Reading 100 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 113926400 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.8 MiB     71.8 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     74.4 MiB      2.6 MiB           1       con = duckdb.connect()
    23     74.5 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     74.5 MiB      0.0 MiB         102           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     74.5 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     74.5 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34    823.0 MiB    748.5 MiB           1       print(con.sql(query).pl())


Memory = 751.25 MB, Time = 10.24 s

------------------------------------------------

[STRESS-SMALL] Reading 200 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 227852800 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.2 MiB     71.2 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.9 MiB      2.7 MiB           1       con = duckdb.connect()
    23     73.9 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     73.9 MiB      0.0 MiB         202           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     73.9 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     73.9 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   1491.4 MiB   1417.5 MiB           1       print(con.sql(query).pl())


Memory = 1420.27 MB, Time = 18.93 s

------------------------------------------------

[STRESS-SMALL] Reading 300 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 341779200 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     70.8 MiB     70.8 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.5 MiB      2.7 MiB           1       con = duckdb.connect()
    23     73.5 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     73.5 MiB      0.0 MiB         302           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     73.6 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     73.5 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   2151.1 MiB   2077.6 MiB           1       print(con.sql(query).pl())


Memory = 2080.33 MB, Time = 28.77 s

------------------------------------------------

[STRESS-SMALL] Reading 400 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 455705600 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.0 MiB     71.0 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.7 MiB      2.7 MiB           1       con = duckdb.connect()
    23     73.8 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     73.8 MiB      0.0 MiB         402           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     73.8 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     73.8 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   2815.0 MiB   2741.2 MiB           1       print(con.sql(query).pl())


Memory = 2743.95 MB, Time = 37.01 s

------------------------------------------------

[STRESS-SMALL] Reading 500 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 569632000 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.2 MiB     71.2 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.9 MiB      2.7 MiB           1       con = duckdb.connect()
    23     74.0 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     74.0 MiB      0.0 MiB         502           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     74.0 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     74.0 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   3483.4 MiB   3409.5 MiB           1       print(con.sql(query).pl())


Memory = 3412.23 MB, Time = 46.53 s

------------------------------------------------

[STRESS-SMALL] Reading 600 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 683558400 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     70.8 MiB     70.8 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.6 MiB      2.7 MiB           1       con = duckdb.connect()
    23     73.6 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     73.6 MiB      0.0 MiB         602           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     73.7 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     73.6 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   4142.4 MiB   4068.7 MiB           1       print(con.sql(query).pl())


Memory = 4071.56 MB, Time = 54.58 s

------------------------------------------------

[STRESS-SMALL] Reading 700 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 797484800 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.3 MiB     71.3 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     74.0 MiB      2.7 MiB           1       con = duckdb.connect()
    23     74.1 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     74.1 MiB      0.1 MiB         702           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     74.1 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     74.1 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   4805.0 MiB   4730.9 MiB           1       print(con.sql(query).pl())


Memory = 4733.67 MB, Time = 62.98 s

------------------------------------------------

[STRESS-SMALL] Reading 800 tables for this run...

------------------------------------------------

shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ i64       │
╞═══════════╡
│ 911411200 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/duckdb_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    20     71.1 MiB     71.1 MiB           1   @profile
    21                                         def stress_test(scale_factors: List[int]):
    22     73.9 MiB      2.8 MiB           1       con = duckdb.connect()
    23     73.9 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    24     73.9 MiB      0.1 MiB         802           f"SELECT * FROM 'tpc/lineitem_{sf}.parquet'" for sf in scale_factors
    25                                             ])
    26     73.9 MiB      0.0 MiB           2       query = f"""
    27                                             SELECT COUNT(*) AS cnt
    28     73.9 MiB      0.0 MiB           1       FROM ({union_query}) AS all_lineitems
    29                                             WHERE l_shipdate >= DATE '1994-01-01'
    30                                               AND l_shipdate <  DATE '1995-01-01'
    31                                               AND l_discount BETWEEN 0.05 AND 0.07
    32                                               AND l_quantity < 24;
    33                                             """
    34   5475.5 MiB   5401.5 MiB           1       print(con.sql(query).pl())


Memory = 5404.30 MB, Time = 73.72 s

--- Elapsed Time (s) ---
Mean:   41.59
Std:    21.92
CV:     52.7%
Min:    10.24
Max:    73.72
Span:   63.48

------------------------------------------------

--- Memory Used (MB) ---
Mean:   3077.20
Std:    1626.59
CV:     52.9%
Min:    751.25
Max:    5404.30
Span:   4653.05

------------------------------------------------

=== Phase 2: Plotting figures (saving to disk) ===
Plot saved to results/polars_duckdb_stress-small_memory.png
Plot saved to results/polars_duckdb_stress-small_time.png
