shape: (1, 1)
┌───────────┐
│ cnt       │
│ ---       │
│ u32       │
╞═══════════╡
│ 731000390 │
└───────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.0 MiB     71.0 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.0 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.0 MiB      0.0 MiB          12           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   5451.5 MiB   2435.8 MiB           3       df = pl.SQLContext().execute(
    28     71.1 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.1 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.1 MiB      0.0 MiB           1           eager=False
    37   5451.4 MiB   2944.7 MiB           1       ).collect(engine="streaming")
    38   5452.1 MiB      0.6 MiB           1       print(df)


Memory = 5382.19 MB, Time = 85.70 s
shape: (1, 1)
┌────────────┐
│ cnt        │
│ ---        │
│ u32        │
╞════════════╡
│ 1462000780 │
└────────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.1 MiB     71.1 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.1 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.1 MiB      0.0 MiB          22           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27   8837.8 MiB   3995.5 MiB           3       df = pl.SQLContext().execute(
    28     71.1 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.1 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.1 MiB      0.0 MiB           1           eager=False
    37   8837.7 MiB   4771.3 MiB           1       ).collect(engine="streaming")
    38   8838.6 MiB      0.8 MiB           1       print(df)


Memory = 8768.36 MB, Time = 175.57 s
shape: (1, 1)
┌────────────┐
│ cnt        │
│ ---        │
│ u32        │
╞════════════╡
│ 2193001170 │
└────────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.1 MiB     71.1 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.1 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.1 MiB      0.0 MiB          32           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27  13151.0 MiB   5630.9 MiB           3       df = pl.SQLContext().execute(
    28     71.1 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.1 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.1 MiB      0.0 MiB           1           eager=False
    37  13151.0 MiB   7449.1 MiB           1       ).collect(engine="streaming")
    38  13151.9 MiB      0.8 MiB           1       print(df)


Memory = 13081.89 MB, Time = 504.53 s
shape: (1, 1)
┌────────────┐
│ cnt        │
│ ---        │
│ u32        │
╞════════════╡
│ 2924001560 │
└────────────┘
Filename: /Users/niklasniggemann/duckdb_motherduck_lab/duckdb_polars_pandas_stresstest/polars_olap.py

Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
    22     71.0 MiB     71.0 MiB           1   @profile
    23                                         def stress_test(scale_factors: List[int]):
    24     71.0 MiB      0.0 MiB           3       union_query = " UNION ALL ".join([
    25     71.0 MiB      0.0 MiB          42           f"SELECT * FROM read_parquet('tpc/lineitem_{sf}.parquet')" for sf in scale_factors
    26                                             ])
    27  15364.3 MiB  11130.7 MiB           3       df = pl.SQLContext().execute(
    28     71.0 MiB      0.0 MiB           2           f"""
    29                                                 SELECT COUNT(*) AS cnt
    30     71.0 MiB      0.0 MiB           1           FROM ({union_query}) AS all_lineitems
    31                                                 WHERE l_shipdate >= DATE '1994-01-01'
    32                                                   AND l_shipdate <  DATE '1995-01-01'
    33                                                   AND l_discount BETWEEN 0.05 AND 0.07
    34                                                   AND l_quantity < 24;
    35                                                 """,
    36     71.0 MiB      0.0 MiB           1           eager=False
    37  15364.2 MiB   4162.6 MiB           1       ).collect(engine="streaming")
    38  15365.2 MiB      0.8 MiB           1       print(df)


Memory = 15295.27 MB, Time = 501.13 s
